{% extends "commerce/_layouts/cp" %}
{% do view.registerTranslations('commerce', []) %}

{% set crumbs = [
  { label: 'Customers'|t('commerce'), url: url('commerce/customers') },
] %}
{% if customerId is defined and customerId %}
  {% set crumbs = crumbs|merge([{ label: 'Customer #{id}'|t('commerce', { id: customerId }), url: cpUrl('commerce/customers/' ~ customerId) }]) %}
{% endif %}

{% set selectedSubnavItem = 'customers' %}

{% set fullPageForm = false %}

{% import "_includes/forms" as forms %}

{% block details %}
    {% if address and address.id %}
        <div class="meta read-only">
            {% if customer and customer.userId and address.id and (customer.primaryBillingAddressId == address.id or customer.primaryShippingAddressId == address.id) %}
                <p><span data-icon="info"></span>
                    {% if customer.primaryBillingAddressId == address.id and customer.primaryShippingAddressId == address.id %}
                        {{ 'This is the primary billing and shipping address for: {email}'|t('commerce', { email: customer.email }) }}
                    {% elseif customer.primaryBillingAddressId == address.id %}
                        {{ 'This is the primary billing address for: {email}'|t('commerce', { email: customer.email }) }}
                    {% elseif customer.primaryShippingAddressId == address.id %}
                        {{ 'This is the primary shipping address for: {email}'|t('commerce', { email: customer.email }) }}
                    {% endif %}
                </p>
            {% endif %}

            <div class="data">
                <h5 class="heading">{{ "Created at"|t('app') }}</h5>
                <div id="date-created-value" class="value">{{ address.dateCreated|datetime('short') }}</div>
            </div>
            <div class="data">
                <h5 class="heading">{{ "Updated at"|t('app') }}</h5>
                <div id="date-updated-value" class="value">{{ address.dateUpdated|datetime('short') }}</div>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block content %}

 
  {{ forms.selectField({
    id: 'country',
    label: 'Country'|t('commerce'),
    name: 'country',
    value: address.countryId,
    options: craft.commerce.countries.allEnabledCountriesAsList,
    class: 'selectize fullwidth'
  }) }}
  <form method="post" {{ attr(mainFormAttributes) }}>
    {% namespace 'address' %}
        {% include 'addresses/_form' %}
      {% endnamespace %}
      
  {{ forms.textField({
    label: 'Attention'|t('commerce'),
    name: 'attention',
    id: 'attention',
    value : address.attention,
    errors: address.getErrors('attention'),
  }) }}

  {{ forms.textField({
    label: 'Title'|t('commerce'),
    name: 'title',
    id: 'title',
    value : address.title,
    errors: address.getErrors('title'),
  }) }}

  {{ forms.textField({
    label: 'Full Name'|t('commerce'),
    name: 'fullName',
    id: 'fullName',
    value : address.fullName,
    errors: address.getErrors('fullName'),
  }) }}

  {{ forms.textField({
    label: 'Address 3'|t('commerce'),
    name: 'address3',
    id: 'address3',
    value : address.address3,
    errors: address.getErrors('address3'),
  }) }}

  {{ forms.textField({
    label: 'Phone'|t('commerce'),
    name: 'phone',
    id: 'phone',
    value : address.phone,
    errors: address.getErrors('phone'),
  }) }}

  {{ forms.textField({
    label: 'Phone (Alt)'|t('commerce'),
    name: 'alternativePhone',
    id: 'alternativePhone',
    value : address.alternativePhone,
    errors: address.getErrors('alternativePhone'),
  }) }}

  {{ forms.textField({
    label: 'Label'|t('commerce'),
    name: 'label',
    id: 'label',
    value : address.label,
    errors: address.getErrors('label'),
  }) }}

  {{ forms.textareaField({
    label: 'Notes'|t('commerce'),
    name: 'notes',
    id: 'notes',
    value : address.notes,
    errors: address.getErrors('notes'),
  }) }}

  {{ forms.textField({
    label: 'Business Tax ID'|t('commerce'),
    name: 'businessTaxId',
    id: 'businessTaxId',
    value : address.businessTaxId,
    errors: address.getErrors('businessTaxId'),
  }) }}

  {{ forms.textField({
    label: 'Business ID'|t('commerce'),
    name: 'businessId',
    id: 'businessId',
    value : address.businessId,
    errors: address.getErrors('businessId'),
  }) }}

  {{ forms.textField({
    label: 'Custom 1'|t('commerce'),
    name: 'custom1',
    id: 'custom1',
    value : address.custom1,
    errors: address.getErrors('custom1'),
  }) }}

  {{ forms.textField({
    label: 'Custom 2'|t('commerce'),
    name: 'custom2',
    id: 'custom2',
    value : address.custom2,
    errors: address.getErrors('custom2'),
  }) }}

  {{ forms.textField({
    label: 'Custom 3'|t('commerce'),
    name: 'custom3',
    id: 'custom3',
    value : address.custom3,
    errors: address.getErrors('custom3'),
  }) }}

  {{ forms.textField({
    label: 'Custom 4'|t('commerce'),
    name: 'custom4',
    id: 'custom4',
    value : address.custom4,
    errors: address.getErrors('custom4'),
  }) }}

  {# Hidden fields #}
  <input type="hidden" name="id" value="{{ address.id }}">
  <input type="hidden" name="customerId" value="{{ customer ? customer.id|hash : null }}">
  <input type="hidden" name="action" value="commerce/addresses/save">
  {% if redirect %}
    {{ redirectInput(redirect) }}
  {% endif %}
</form>
{% endblock %}

{% js %}

  var url = "{{ craft.app.request.fullUri }}";
  var queryParams = '{{ craft.app.request.queryParams|json_encode|raw }}';
  $('#country').selectize({
    onItemAdd: function(value, isOnInitialize) {
      var params = JSON.parse(queryParams);
      params = {...params, ...{ countryId: value }}
      window.location = Craft.getUrl('admin/commerce/addresses/new', params);
    }
  });

{% endjs %}
{% css %}
  .field-inline-block {
    display: inline-block;
    margin-bottom: 0;
  }
  
  #country-field {
    margin-bottom: 0;
  }
{% endcss %}