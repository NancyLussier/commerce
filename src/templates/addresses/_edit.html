{% extends "commerce/_layouts/cp" %}
{% do view.registerTranslations('commerce', []) %}

{% set crumbs = [
  { label: 'Customers'|t('commerce'), url: url('commerce/customers') },
] %}
{% if customerId is defined and customerId %}
  {% set crumbs = crumbs|merge([{ label: 'Customer #{id}'|t('commerce', { id: customerId }), url: cpUrl('commerce/customers/' ~ customerId) }]) %}
{% endif %}

{% set selectedSubnavItem = 'customers' %}

{% set fullPageForm = false %}

{% import "_includes/forms" as forms %}

{% block details %}
    {% if address and address.id %}
        <div class="meta read-only">
            {% if customer and customer.userId and address.id and (customer.primaryBillingAddressId == address.id or customer.primaryShippingAddressId == address.id) %}
                <p><span data-icon="info"></span>
                    {% if customer.primaryBillingAddressId == address.id and customer.primaryShippingAddressId == address.id %}
                        {{ 'This is the primary billing and shipping address for: {email}'|t('commerce', { email: customer.email }) }}
                    {% elseif customer.primaryBillingAddressId == address.id %}
                        {{ 'This is the primary billing address for: {email}'|t('commerce', { email: customer.email }) }}
                    {% elseif customer.primaryShippingAddressId == address.id %}
                        {{ 'This is the primary shipping address for: {email}'|t('commerce', { email: customer.email }) }}
                    {% endif %}
                </p>
            {% endif %}

            <div class="data">
                <h5 class="heading">{{ "Created at"|t('app') }}</h5>
                <div id="date-created-value" class="value">{{ address.dateCreated|datetime('short') }}</div>
            </div>
            <div class="data">
                <h5 class="heading">{{ "Updated at"|t('app') }}</h5>
                <div id="date-updated-value" class="value">{{ address.dateUpdated|datetime('short') }}</div>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block content %}
    

  <form method="post" {{ attr(mainFormAttributes) }}>
 
    {{ craft.commerce.addresses.buildAddressForm(address)|raw }}
  {# Hidden fields #}
  <input type="hidden" name="id" value="{{ address.id }}">
  <input type="hidden" name="customerId" value="{{ customer ? customer.id|hash : null }}">
  <input type="hidden" name="action" value="commerce/addresses/save">
  {% if redirect %}
    {{ redirectInput(redirect) }}
  {% endif %}
</form>
{% endblock %}

{% js %}

  var url = "{{ craft.app.request.fullUri }}";
  var queryParams = '{{ craft.app.request.queryParams|json_encode|raw }}';
  $('#country').selectize({
    onItemAdd: function(value, isOnInitialize) {
      var params = JSON.parse(queryParams);
      params = {...params, ...{ countryId: value }}
      window.location = Craft.getUrl('admin/commerce/addresses/new', params);
    }
  });

{% endjs %}
{% css %}
  .field-inline-block {
    display: inline-block;
    margin-bottom: 0;
  }
  
  #country-field {
    margin-bottom: 0;
  }
{% endcss %}